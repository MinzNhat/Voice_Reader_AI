<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Reader AI - API Test</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; }
        h1 { margin-bottom: 30px; color: #333; }
        .section { background: white; padding: 20px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        h2 { color: #0066cc; margin-bottom: 15px; font-size: 18px; }
        input[type="file"], input[type="text"], input[type="number"], textarea { width: 100%; padding: 10px; margin: 5px 0; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; }
        button { background: #0066cc; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; margin-top: 10px; }
        button:hover { background: #0052a3; }
        .result { margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 4px; border-left: 4px solid #0066cc; }
        .result pre { overflow-x: auto; font-size: 12px; }
        .error { border-left-color: #dc3545; background: #f8d7da; }
        .success { border-left-color: #28a745; background: #d4edda; }
        audio { width: 100%; margin-top: 10px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        @media (max-width: 768px) { .grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéôÔ∏è Voice Reader AI - API Test Panel</h1>

        <div class="grid">
            <div class="section">
                <h2>üìù Test OCR</h2>
                <input type="file" id="ocrFile" accept="image/*,application/pdf">
                <button onclick="testOCR()">Run OCR</button>
                <div id="ocrResult"></div>
            </div>

            <div class="section">
                <h2>‚úÇÔ∏è Test OCR with Crop</h2>
                <input type="file" id="cropFile" accept="image/*">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px;">
                    <input type="number" id="cropX" placeholder="X" value="0">
                    <input type="number" id="cropY" placeholder="Y" value="0">
                    <input type="number" id="cropWidth" placeholder="Width" value="100">
                    <input type="number" id="cropHeight" placeholder="Height" value="100">
                </div>
                <button onclick="testCrop()">Run OCR Crop</button>
                <div id="cropResult"></div>
            </div>

            <div class="section">
                <h2>üîä Test TTS</h2>
                <textarea id="ttsText" rows="4" placeholder="Enter text to convert to speech...">Hello world, this is a test.</textarea>
                <input type="text" id="ttsSpeaker" placeholder="Speaker (default: nara)" value="nara">
                <button onclick="testTTS()">Generate Speech</button>
                <div id="ttsResult"></div>
            </div>

            <div class="section">
                <h2>‚è±Ô∏è Test Timing</h2>
                <textarea id="timingText" rows="4" placeholder="Enter text for timing calculation...">Hello world this is a test</textarea>
                <button onclick="testTiming()">Calculate Timing</button>
                <div id="timingResult"></div>
            </div>
        </div>
        
        <div style="text-align: center; margin-top: 20px;">
            <a href="/rag.html" style="font-size: 18px; color: #0066cc; text-decoration: none;">üëâ Go to RAG Chatbot Demo</a>
        </div>
    </div>

<script>
    // C·∫•u h√¨nh Base URL (Ch·∫°y local th√¨ d√πng localhost)
    const API_BASE = "http://localhost:3000/api";

    function showResult(elementId, data, isError = false) {
        const element = document.getElementById(elementId);
        element.className = 'result ' + (isError ? 'error' : 'success');
        element.innerHTML = '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
    }

    async function testOCR() {
        const fileInput = document.getElementById("ocrFile");
        const file = fileInput.files[0];
        if (!file) return alert("Please select a file");

        const formData = new FormData();
        formData.append("image", file);

        try {
            const res = await fetch(`${API_BASE}/ocr/extract`, {
                method: "POST",
                body: formData
            });
            const data = await res.json();
            showResult("ocrResult", data, !res.ok);
        } catch (e) {
            showResult("ocrResult", { error: e.message }, true);
        }
    }

    async function testCrop() {
        const fileInput = document.getElementById("cropFile");
        const file = fileInput.files[0];
        if (!file) return alert("Please select a file");

        const formData = new FormData();
        formData.append("image", file);
        formData.append("x", document.getElementById("cropX").value);
        formData.append("y", document.getElementById("cropY").value);
        formData.append("width", document.getElementById("cropWidth").value);
        formData.append("height", document.getElementById("cropHeight").value);

        try {
            const res = await fetch(`${API_BASE}/ocr/crop`, {
                method: "POST",
                body: formData
            });
            const data = await res.json();
            showResult("cropResult", data, !res.ok);
        } catch (e) {
            showResult("cropResult", { error: e.message }, true);
        }
    }

    async function testTTS() {
        const text = document.getElementById("ttsText").value;
        const speaker = document.getElementById("ttsSpeaker").value;

        try {
            const res = await fetch(`${API_BASE}/tts/synthesize`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ text, speaker })
            });

            const json = await res.json();

            if (res.ok && json.data?.audio) {
                const audio = new Audio(`data:audio/mp3;base64,${json.data.audio}`);
                audio.controls = true;

                const div = document.getElementById("ttsResult");
                div.className = "result success";
                div.innerHTML = "<p>Audio generated:</p>";
                div.appendChild(audio);
            } else showResult("ttsResult", json, true);

        } catch (e) { showResult("ttsResult", { error: e.message }, true); }
    }

    async function testTiming() {
        const text = document.getElementById("timingText").value;

        try {
            const res = await fetch(`${API_BASE}/tts/timing`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ text })
            });

            const json = await res.json();
            showResult("timingResult", json, !res.ok);

        } catch (e) {
            showResult("timingResult", { error: e.message }, true);
        }
    }
</script>
</body>
</html>